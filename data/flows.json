[
    {
        "id": "718459f3.4a42d8",
        "type": "tab",
        "label": "First_Flow",
        "disabled": false,
        "info": ""
    },
    {
        "id": "3f771ea3.7ae222",
        "type": "tab",
        "label": "Flow 1"
    },
    {
        "id": "bf01498e.e4c518",
        "type": "subflow",
        "name": "set user",
        "info": "",
        "in": [],
        "out": []
    },
    {
        "id": "73fb07f4.a52948",
        "type": "credentials-config",
        "z": "718459f3.4a42d8",
        "name": "webchat",
        "rules": [
            {
                "p": "secret",
                "tot": "str"
            }
        ]
    },
    {
        "id": "b17e0003.442d7",
        "type": "mongodb",
        "z": "",
        "name": "chatbot_db"
    },
    {
        "id": "ad575965.c96648",
        "type": "node-recast-config",
        "z": "",
        "name": "DevToken",
        "lang": "fr"
    },
    {
        "id": "db853bd.d7886c8",
        "type": "bot",
        "z": "718459f3.4a42d8",
        "name": "bot",
        "project": "",
        "port": "",
        "x": 50,
        "y": 300,
        "wires": [
            [
                "89c46a99.f8aa68"
            ]
        ]
    },
    {
        "id": "22586edf.7e5f82",
        "type": "http in",
        "z": "718459f3.4a42d8",
        "name": "",
        "url": "/webchat",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 60,
        "wires": [
            [
                "402738d9.4b33e8"
            ]
        ]
    },
    {
        "id": "965c2dac.d234a",
        "type": "template",
        "z": "718459f3.4a42d8",
        "name": "chat",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<html>\n  <head>\n    <title>Webchat</title>\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\" />\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.botframework.com/botframework-webchat/latest/botchat.css\">\n  </head>\n\n<body id=\"bg\">\n    <div id=\"bot\"></div>\n    \n    <script src=\"https://code.jquery.com/jquery-3.1.1.slim.min.js\" integrity=\"sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n\" crossorigin=\"anonymous\"></script>\n    <script src=\"https://cdn.botframework.com/botframework-webchat/latest/botchat.js\" width=\"400\"></script>\n    <script>\n        var name = \"Alex\";\n        var userid = Math.floor(Math.random() * 10) + \"\" + Date.now()+ \"\" +Math.floor(Math.random() * 10);\n        var connector = new BotChat.DirectLine ({ secret: \"{{parameters.secret}}\" });\n        \n          BotChat.App({\n            botConnection: connector,\n            user: { \n                id: userid\n            },\n            bot:  { \n                id: 'viseBot'\n            },\n            resize: 'detect'\n          }, document.getElementById(\"bot\"));\n          \n          connector.postActivity({\n            from: { \n                id:   userid,\n            },\n                type: 'message',\n                text: 'CMD-START'\n            }).subscribe(\n                id => {},\n                error => console.log(\"Error posting activity\", error)\n            );\n    </script>\n  </body>\n</html>",
        "output": "str",
        "x": 410,
        "y": 60,
        "wires": [
            [
                "74fe2bfb.8a6fc4"
            ]
        ]
    },
    {
        "id": "74fe2bfb.8a6fc4",
        "type": "http response",
        "z": "718459f3.4a42d8",
        "name": "200",
        "statusCode": "200",
        "headers": {},
        "x": 530,
        "y": 60,
        "wires": []
    },
    {
        "id": "402738d9.4b33e8",
        "type": "set-credentials",
        "z": "718459f3.4a42d8",
        "name": "creds",
        "set": "parameters",
        "setType": "msg",
        "rules": "73fb07f4.a52948",
        "x": 290,
        "y": 60,
        "wires": [
            [
                "965c2dac.d234a"
            ]
        ]
    },
    {
        "id": "89c46a99.f8aa68",
        "type": "function",
        "z": "718459f3.4a42d8",
        "name": "func",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 130,
        "y": 260,
        "wires": [
            [
                "f0c4d67c.8a07a8"
            ]
        ]
    },
    {
        "id": "f0c4d67c.8a07a8",
        "type": "send-card",
        "z": "718459f3.4a42d8",
        "name": "name",
        "labels": [
            "Default output"
        ],
        "nodeid": "SEND_1543586726408",
        "delay": "0",
        "repeat": "0",
        "outputs": 1,
        "btnOutput": false,
        "quickOutput": false,
        "prompt": true,
        "promptText": "payload",
        "promptTextType": "msg",
        "speech": false,
        "speechText": "",
        "sendType": "text",
        "text": "Bonjour ! Comment t'appelles-tu ?",
        "random": false,
        "media": "",
        "mediaType": "str",
        "eventName": "",
        "eventValue": "",
        "eventValueType": "str",
        "title": "",
        "titleType": "str",
        "subtitle": "",
        "attach": "",
        "attachType": "str",
        "carousel": false,
        "buttons": [
            {
                "title": "",
                "action": "postBack",
                "value": "",
                "regexp": ""
            }
        ],
        "quicktext": "",
        "quickreplies": [
            {
                "title": "",
                "action": "postBack",
                "value": "",
                "regexp": ""
            }
        ],
        "signintext": "",
        "signintitle": "",
        "signintitleType": "str",
        "signinurl": "",
        "signinurlType": "str",
        "shcardtext": "",
        "shcardtitle": "",
        "shcardtitleType": "str",
        "shcardimage": "",
        "shcardimageType": "str",
        "shcardbutton": "",
        "shcardbuttonType": "str",
        "shcardurl": "",
        "shcardurlType": "str",
        "x": 190,
        "y": 300,
        "wires": [
            [
                "1c5c30bf.21c8bf"
            ]
        ]
    },
    {
        "id": "1f159975.e41bb7",
        "type": "profile",
        "z": "718459f3.4a42d8",
        "name": "profile",
        "defaultLocale": "fr_FR",
        "x": 809.0000190734863,
        "y": 299.00000762939453,
        "wires": [
            []
        ]
    },
    {
        "id": "354301b6.a5314e",
        "type": "debug",
        "z": "718459f3.4a42d8",
        "name": "msg_db",
        "active": true,
        "console": false,
        "complete": "true",
        "x": 762.0000152587891,
        "y": 244.00000667572021,
        "wires": []
    },
    {
        "id": "f71090d4.0ebd9",
        "type": "function",
        "z": "718459f3.4a42d8",
        "name": "fname_key",
        "func": "msg.key = {\n    fname: msg.user.name\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 534.0000076293945,
        "y": 300.00000381469727,
        "wires": [
            [
                "ee0ed0d0.6da81"
            ]
        ]
    },
    {
        "id": "ee0ed0d0.6da81",
        "type": "nosql",
        "z": "718459f3.4a42d8",
        "name": "mongo",
        "server-type": "mongodb",
        "collection": "users",
        "collectionType": "str",
        "key": "key",
        "offset": "0",
        "offsetType": "num",
        "limit": "10",
        "limitType": "num",
        "value": "userFound",
        "operation": "find",
        "merge": false,
        "server-mongodb": "b17e0003.442d7",
        "server-nedb": "",
        "x": 679.0000076293945,
        "y": 300.00000381469727,
        "wires": [
            [
                "1f159975.e41bb7",
                "354301b6.a5314e"
            ]
        ]
    },
    {
        "id": "1c5c30bf.21c8bf",
        "type": "node-recast",
        "z": "718459f3.4a42d8",
        "name": "recast",
        "key": "ad575965.c96648",
        "input": "payload",
        "inputType": "msg",
        "output": "payload",
        "outputType": "msg",
        "x": 314.10000228881836,
        "y": 300.00000190734863,
        "wires": [
            [
                "d0bf2b6f.9712c8"
            ]
        ]
    },
    {
        "id": "ca258843.53d888",
        "type": "bot",
        "z": "3f771ea3.7ae222",
        "name": "bot",
        "project": "",
        "port": "",
        "x": 62.000003814697266,
        "y": 281.00000381469727,
        "wires": [
            [
                "a499c3b7.e3f7d"
            ]
        ]
    },
    {
        "id": "a499c3b7.e3f7d",
        "type": "function",
        "z": "3f771ea3.7ae222",
        "name": "func",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 139.00000381469727,
        "y": 238.00000286102295,
        "wires": [
            [
                "d1f4e1ea.fd648"
            ]
        ]
    },
    {
        "id": "d1f4e1ea.fd648",
        "type": "send-card",
        "z": "3f771ea3.7ae222",
        "name": "name",
        "labels": [
            "Default output"
        ],
        "nodeid": "SEND_1544087363405",
        "delay": "0",
        "repeat": "0",
        "outputs": 1,
        "btnOutput": false,
        "quickOutput": false,
        "prompt": true,
        "promptText": "user.name",
        "promptTextType": "msg",
        "speech": false,
        "speechText": "",
        "sendType": "text",
        "text": "Bonjour ! Quel est ton pr√©nom ?",
        "random": false,
        "media": "",
        "mediaType": "str",
        "eventName": "",
        "eventValue": "",
        "eventValueType": "str",
        "title": "",
        "titleType": "str",
        "subtitle": "",
        "attach": "",
        "attachType": "str",
        "carousel": false,
        "buttons": [
            {
                "title": "",
                "action": "postBack",
                "value": "",
                "regexp": ""
            }
        ],
        "quicktext": "",
        "quickreplies": [
            {
                "title": "",
                "action": "postBack",
                "value": "",
                "regexp": ""
            }
        ],
        "signintext": "",
        "signintitle": "",
        "signintitleType": "str",
        "signinurl": "",
        "signinurlType": "str",
        "shcardtext": "",
        "shcardtitle": "",
        "shcardtitleType": "str",
        "shcardimage": "",
        "shcardimageType": "str",
        "shcardbutton": "",
        "shcardbuttonType": "str",
        "shcardurl": "",
        "shcardurlType": "str",
        "x": 211.00000381469727,
        "y": 281.00000381469727,
        "wires": [
            [
                "21d6100a.7245a"
            ]
        ]
    },
    {
        "id": "21d6100a.7245a",
        "type": "function",
        "z": "3f771ea3.7ae222",
        "name": "fname_key",
        "func": "msg.key = {\n    fname: msg.user.name\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 355.00000762939453,
        "y": 281.00000381469727,
        "wires": [
            [
                "8df93d82.d308e"
            ]
        ]
    },
    {
        "id": "8df93d82.d308e",
        "type": "nosql",
        "z": "3f771ea3.7ae222",
        "name": "mongo",
        "server-type": "mongodb",
        "collection": "users",
        "collectionType": "str",
        "key": "key",
        "offset": "0",
        "offsetType": "num",
        "limit": "10",
        "limitType": "num",
        "value": "userFound",
        "operation": "find",
        "merge": false,
        "server-mongodb": "b17e0003.442d7",
        "server-nedb": "",
        "x": 506.00000762939453,
        "y": 281.00000381469727,
        "wires": [
            []
        ]
    },
    {
        "id": "d0bf2b6f.9712c8",
        "type": "debug",
        "z": "718459f3.4a42d8",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 348.1000061035156,
        "y": 232,
        "wires": []
    }
]